---
import { getLangFromUrl, useTranslations } from "../i18n";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="hero-section">
  <!-- Background Image -->
  <div
    class="hero-bg"
    style={`background-image: url('${import.meta.env.BASE_URL}images/homehero.png')`}
  >
  </div>

  <!-- Overlay -->
  <div class="hero-overlay"></div>

  <div class="container-custom relative z-10">
    <div
      class="max-w-4xl mx-auto text-center flex flex-col items-center justify-center"
    >
      <div class="hero-badge">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path
            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
          ></path>
        </svg>
        <span class="text-sm font-medium">ISO 9001-2015 Certified</span>
      </div>

      <!-- Logo -->
      <div class="mb-6">
        <img
          src={import.meta.env.BASE_URL + "images/LogoColor.svg"}
          alt="Bufete Jurídico Pazos Chávez"
          class="h-32 md:h-40 mx-auto"
        />
      </div>

      <p class="hero-subtitle">
        {t("hero.subtitle")}
      </p>

      <p class="text-lg md:text-xl text-gray-600 mb-12 max-w-2xl mx-auto">
        {t("hero.description")}
      </p>

      <!-- Stats -->
      <div
        class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12"
        id="stats-container"
      >
        <div class="card-stats">
          <div class="stat-value" data-target="40">0+</div>
          <div class="stat-label">{t("stats.experience")}</div>
        </div>
        <div class="card-stats">
          <div class="stat-value" data-target="21">0</div>
          <div class="stat-label">{t("stats.services")}</div>
        </div>
        <div class="card-stats">
          <div class="stat-value" data-target="50">0+</div>
          <div class="stat-label">{t("stats.professionals")}</div>
        </div>
        <div class="card-stats">
          <div class="stat-value" data-target="100">0+</div>
          <div class="stat-label">{t("stats.wonCases")}</div>
        </div>
      </div>

      <!-- CTA Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
        <a href="#contacto" class="btn-submit">
          {t("hero.cta")}
        </a>
        <a href="#servicios-legales" class="btn-secondary">
          {t("hero.cta.secondary")}
        </a>
      </div>

      <!-- Phone number -->
      <div class="mt-12">
        <a
          href="tel:+525550250709"
          class="link-arrow inline-flex items-center space-x-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
            ></path>
          </svg>
          <span class="text-xl font-semibold">55 50 25 07 09</span>
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  // Animate stats numbers on scroll
  const observerOptions = {
    threshold: 0.5,
    rootMargin: "0px",
  };

  const animateNumber = (
    element: HTMLElement,
    target: number,
    hasSuffix: boolean
  ) => {
    const duration = 2000; // 2 seconds
    const steps = 60;
    const increment = target / steps;
    let current = 0;

    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      element.textContent =
        Math.floor(current).toString() + (hasSuffix ? "+" : "");
    }, duration / steps);
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const statElements = entry.target.querySelectorAll("[data-target]");
        statElements.forEach((el) => {
          const element = el as HTMLElement;
          const target = parseInt(element.getAttribute("data-target") || "0");
          const hasSuffix = element.textContent?.includes("+") || false;
          animateNumber(element, target, hasSuffix);
        });
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  const statsContainer = document.getElementById("stats-container");
  if (statsContainer) {
    observer.observe(statsContainer);
  }
</script>
